(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1931],{77630:function(e,t,r){Promise.resolve().then(r.bind(r,16117))},16117:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return i}});var o=r(57437),a=r(2265),s=r(99376),n=r(71245);function i(){let e=(0,s.useRouter)(),{user:t,isLoading:r}=(0,n.a)();return(0,a.useEffect)(()=>{if(!r){if(t)switch(t.rol){case"Admin":e.push("/admin/dashboard");break;case"Empleado":e.push("/empleado/dashboard");break;case"Cliente":e.push("/cliente/tickets");break;default:e.push("/login")}else e.push("/login")}},[t,r,e]),(0,o.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 dark:bg-gray-900",children:(0,o.jsxs)("div",{className:"text-center",children:[(0,o.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-600 mx-auto"}),(0,o.jsx)("p",{className:"mt-4 text-gray-600 dark:text-gray-400",children:"Cargando..."})]})})}},71245:function(e,t,r){"use strict";r.d(t,{H:function(){return c},a:function(){return u}});var o=r(57437),a=r(2265),s=r(99376),n=r(71837),i=r(69064);let l=(0,a.createContext)(void 0);function c(e){let{children:t}=e,[r,c]=(0,a.useState)(null),[u,d]=(0,a.useState)(!0),m=(0,s.useRouter)();(0,a.useEffect)(()=>{h()},[]);let h=async()=>{try{let e=localStorage.getItem("token");if(!e){d(!1);return}let t=localStorage.getItem("demo_user");if(e.startsWith("demo-token-")&&t){let e=JSON.parse(t);c(e),d(!1);return}let r=await n.ZP.get("/auth/me");c(r.data)}catch(t){let e=localStorage.getItem("demo_user");if(e)try{let t=JSON.parse(e);c(t),d(!1);return}catch(e){}localStorage.removeItem("token"),localStorage.removeItem("demo_user")}finally{d(!1)}},p=async(e,t)=>{try{let{token:r,user:o}=(await n.ZP.post("/auth/login",e)).data;if(localStorage.setItem("token",r),c(o),o.requiereCambioPassword){m.push("/cambiar-password");return}if(t&&f(t,o.rol)){m.push(t),i.ZP.success("Bienvenido, ".concat(o.nombre));return}switch(o.rol){case"Admin":m.push("/admin/dashboard");break;case"Empleado":m.push("/empleado/dashboard");break;case"Cliente":m.push("/cliente/tickets")}i.ZP.success("Bienvenido, ".concat(o.nombre))}catch(t){var r,o;let e=(null===(o=t.response)||void 0===o?void 0:null===(r=o.data)||void 0===r?void 0:r.message)||"Error al iniciar sesion";throw i.ZP.error(e),t}},f=(e,t)=>"Admin"===t||("Empleado"===t?e.startsWith("/empleado/")||e.startsWith("/admin/tickets"):"Cliente"===t&&e.startsWith("/cliente/")),g=async()=>{try{let e=localStorage.getItem("token");(null==e?void 0:e.startsWith("demo-token-"))||await n.ZP.post("/auth/logout")}catch(e){}finally{localStorage.removeItem("token"),localStorage.removeItem("demo_user"),c(null),m.push("/login"),i.ZP.success("Sesion cerrada")}};return(0,o.jsx)(l.Provider,{value:{user:r,isLoading:u,login:p,logout:g,updateUser:e=>{c(e)}},children:t})}function u(){let e=(0,a.useContext)(l);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},71837:function(e,t,r){"use strict";var o=r(83464);let a=(()=>{{let e=window.location.hostname;return"localhost"===e||"127.0.0.1"===e?"http://localhost:5000/api":"/api"}})(),s=o.Z.create({baseURL:a,headers:{"Content-Type":"application/json"},timeout:3e4});s.interceptors.request.use(e=>{{let t=localStorage.getItem("token");t&&(e.headers.Authorization="Bearer ".concat(t))}return e},e=>Promise.reject(e)),s.interceptors.response.use(e=>e,e=>{if(e.response){let{status:t,data:r}=e.response;if(401===t){localStorage.removeItem("token");let e=window.location.pathname;e.includes("/login")||e.includes("/solicitar-registro")||(window.location.href="/login")}if(403===t&&console.error("Access forbidden:",null==r?void 0:r.message),400===t&&(null==r?void 0:r.errors)){let t=Object.values(r.errors).flat().join(", ");e.message=t||r.message||"Error de validacion"}}else e.request&&(e.message="Error de conexion. Verifica tu conexion a internet.");return Promise.reject(e)}),t.ZP=s}},function(e){e.O(0,[7859,3464,2971,2117,1744],function(){return e(e.s=77630)}),_N_E=e.O()}]);