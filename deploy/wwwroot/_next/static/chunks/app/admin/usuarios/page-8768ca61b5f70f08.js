(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7798],{59095:function(e,a,t){Promise.resolve().then(t.bind(t,95009))},95009:function(e,a,t){"use strict";t.r(a),t.d(a,{default:function(){return d}});var r=t(57437),s=t(2265),l=t(11888),i=t(71837);function d(){let[e,a]=(0,s.useState)([]),[t,d]=(0,s.useState)([]),[n,o]=(0,s.useState)(!0),[c,x]=(0,s.useState)(null),[m,u]=(0,s.useState)("empleados"),[h,p]=(0,s.useState)(!1),[g,v]=(0,s.useState)(null),[y,b]=(0,s.useState)({email:"",nombre:"",rol:"Empleado",empresaId:null,activo:!0}),[j,k]=(0,s.useState)(!1),[N,f]=(0,s.useState)(null),[w,C]=(0,s.useState)(!1),[E,S]=(0,s.useState)(null),[L,A]=(0,s.useState)(null),[I,z]=(0,s.useState)(!1),[M,P]=(0,s.useState)(null),Z=(0,s.useCallback)(async()=>{try{o(!0);let e="empleados"===m?"Empleado":"Cliente",t=await i.ZP.get("/usuarios?rol=".concat(e));a(t.data),x(null)}catch(a){var e,t;x((null===(t=a.response)||void 0===t?void 0:null===(e=t.data)||void 0===e?void 0:e.message)||"Error al cargar usuarios")}finally{o(!1)}},[m]),U=async()=>{try{let e=await i.ZP.get("/empresas");d(e.data)}catch(e){console.error("Error al cargar empresas:",e)}};(0,s.useEffect)(()=>{Z(),U()},[Z]);let H=e=>{e?(v(e),b({email:e.email,nombre:e.nombre,rol:e.rol,empresaId:e.empresaId,activo:e.activo})):(v(null),b({email:"",nombre:"",rol:"empleados"===m?"Empleado":"Cliente",empresaId:null,activo:!0})),f(null),p(!0)},B=()=>{p(!1),v(null),f(null)},W=async e=>{e.preventDefault(),k(!0),f(null);try{if(g){let e={email:y.email,nombre:y.nombre,rol:y.rol,empresaId:y.empresaId,activo:y.activo};await i.ZP.put("/usuarios/".concat(g.id),e),B(),Z()}else{let e={email:y.email,nombre:y.nombre,rol:y.rol,empresaId:y.empresaId},a=await i.ZP.post("/usuarios",e);B(),S(a.data.temporaryPassword),A(y.nombre),C(!0),Z()}}catch(e){var a,t;f((null===(t=e.response)||void 0===t?void 0:null===(a=t.data)||void 0===a?void 0:a.message)||"Error al guardar usuario")}finally{k(!1)}},_=async e=>{try{await i.ZP.put("/usuarios/".concat(e.id,"/toggle-active")),Z()}catch(e){var a,t;x((null===(t=e.response)||void 0===t?void 0:null===(a=t.data)||void 0===a?void 0:a.message)||"Error al cambiar estado")}},q=async e=>{try{let a=await i.ZP.post("/usuarios/".concat(e.id,"/reset-password"));S(a.data.temporaryPassword),A(e.nombre),C(!0)}catch(e){var a,t;x((null===(t=e.response)||void 0===t?void 0:null===(a=t.data)||void 0===a?void 0:a.message)||"Error al resetear contrasena")}},D=e=>{P(e),z(!0)},G=async()=>{if(M)try{await i.ZP.delete("/usuarios/".concat(M.id)),z(!1),P(null),Z()}catch(t){var e,a;x((null===(a=t.response)||void 0===a?void 0:null===(e=a.data)||void 0===e?void 0:e.message)||"Error al eliminar usuario")}},R=e=>e?new Date(e).toLocaleDateString("es-ES",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}):"Nunca";return(0,r.jsxs)(l.Zn,{requiredRoles:["Admin"],children:[(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Gestion de Usuarios"}),(0,r.jsx)("p",{className:"text-gray-600 dark:text-gray-400",children:"Administra empleados y clientes del sistema"})]}),(0,r.jsx)("button",{className:"btn-primary",onClick:()=>H(),children:"Nuevo Usuario"})]}),c&&(0,r.jsx)("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-4",children:(0,r.jsx)("p",{className:"text-red-600 dark:text-red-400",children:c})}),(0,r.jsx)("div",{className:"border-b border-gray-200 dark:border-gray-700",children:(0,r.jsxs)("nav",{className:"-mb-px flex space-x-8",children:[(0,r.jsx)("button",{onClick:()=>u("empleados"),className:"whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm ".concat("empleados"===m?"border-primary-500 text-primary-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:"Empleados"}),(0,r.jsx)("button",{onClick:()=>u("clientes"),className:"whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm ".concat("clientes"===m?"border-primary-500 text-primary-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:"Clientes"})]})}),(0,r.jsx)("div",{className:"card overflow-hidden",children:n?(0,r.jsxs)("div",{className:"p-8 text-center",children:[(0,r.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600 mx-auto"}),(0,r.jsx)("p",{className:"mt-2 text-gray-500 dark:text-gray-400",children:"Cargando usuarios..."})]}):(0,r.jsxs)("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[(0,r.jsx)("thead",{className:"bg-gray-50 dark:bg-gray-800",children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Usuario"}),"clientes"===m&&(0,r.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Empresa"}),(0,r.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Estado"}),(0,r.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Ultimo Acceso"}),(0,r.jsx)("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Acciones"})]})}),(0,r.jsx)("tbody",{className:"bg-white dark:bg-gray-900 divide-y divide-gray-200 dark:divide-gray-700",children:0===e.length?(0,r.jsx)("tr",{children:(0,r.jsxs)("td",{colSpan:"clientes"===m?5:4,className:"px-6 py-12 text-center",children:[(0,r.jsx)("svg",{className:"mx-auto h-12 w-12 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"})}),(0,r.jsxs)("p",{className:"mt-4 text-gray-500 dark:text-gray-400",children:["No hay ","empleados"===m?"empleados":"clientes"," registrados"]})]})}):e.map(e=>(0,r.jsxs)("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-800",children:[(0,r.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)("div",{className:"h-10 w-10 flex-shrink-0",children:(0,r.jsx)("div",{className:"h-10 w-10 rounded-full bg-primary-100 dark:bg-primary-900 flex items-center justify-center",children:(0,r.jsx)("span",{className:"text-primary-600 dark:text-primary-400 font-medium text-sm",children:e.nombre.charAt(0).toUpperCase()})})}),(0,r.jsxs)("div",{className:"ml-4",children:[(0,r.jsx)("div",{className:"text-sm font-medium text-gray-900 dark:text-white",children:e.nombre}),(0,r.jsx)("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:e.email})]})]})}),"clientes"===m&&(0,r.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400",children:e.empresaNombre||"-"}),(0,r.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,r.jsx)("span",{className:"inline-flex px-2 py-1 text-xs font-semibold rounded-full ".concat(e.activo?"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200":"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200"),children:e.activo?"Activo":"Inactivo"})}),(0,r.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400",children:R(e.ultimoAcceso)}),(0,r.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium space-x-2",children:[(0,r.jsx)("button",{onClick:()=>H(e),className:"text-primary-600 hover:text-primary-900 dark:text-primary-400 dark:hover:text-primary-300",title:"Editar",children:(0,r.jsx)("svg",{className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})})}),(0,r.jsx)("button",{onClick:()=>q(e),className:"text-yellow-600 hover:text-yellow-900 dark:text-yellow-400 dark:hover:text-yellow-300",title:"Resetear contrasena",children:(0,r.jsx)("svg",{className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 7a2 2 0 012 2m4 0a6 6 0 01-7.743 5.743L11 17H9v2H7v2H4a1 1 0 01-1-1v-2.586a1 1 0 01.293-.707l5.964-5.964A6 6 0 1121 9z"})})}),(0,r.jsx)("button",{onClick:()=>_(e),className:"".concat(e.activo?"text-orange-600 hover:text-orange-900 dark:text-orange-400 dark:hover:text-orange-300":"text-green-600 hover:text-green-900 dark:text-green-400 dark:hover:text-green-300"),title:e.activo?"Desactivar":"Activar",children:(0,r.jsx)("svg",{className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:e.activo?"M18.364 18.364A9 9 0 005.636 5.636m12.728 12.728A9 9 0 015.636 5.636m12.728 12.728L5.636 5.636":"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})})}),(0,r.jsx)("button",{onClick:()=>D(e),className:"text-red-600 hover:text-red-900 dark:text-red-400 dark:hover:text-red-300",title:"Eliminar",children:(0,r.jsx)("svg",{className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})]},e.id))})]})})]}),h&&(0,r.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,r.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-6 w-full max-w-md",children:[(0,r.jsx)("h2",{className:"text-xl font-bold text-gray-900 dark:text-white mb-4",children:g?"Editar Usuario":"Nuevo Usuario"}),(0,r.jsxs)("form",{onSubmit:W,className:"space-y-4",children:[N&&(0,r.jsx)("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-3",children:(0,r.jsx)("p",{className:"text-sm text-red-600 dark:text-red-400",children:N})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Nombre *"}),(0,r.jsx)("input",{type:"text",required:!0,value:y.nombre,onChange:e=>b({...y,nombre:e.target.value}),className:"input w-full",placeholder:"Nombre completo"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Email *"}),(0,r.jsx)("input",{type:"email",required:!0,value:y.email,onChange:e=>b({...y,email:e.target.value}),className:"input w-full",placeholder:"correo@ejemplo.com"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Rol *"}),(0,r.jsxs)("select",{required:!0,value:y.rol,onChange:e=>b({...y,rol:e.target.value}),className:"input w-full",children:[(0,r.jsx)("option",{value:"Empleado",children:"Empleado"}),(0,r.jsx)("option",{value:"Cliente",children:"Cliente"}),(0,r.jsx)("option",{value:"Admin",children:"Administrador"})]})]}),"Cliente"===y.rol&&(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Empresa"}),(0,r.jsxs)("select",{value:y.empresaId||"",onChange:e=>b({...y,empresaId:e.target.value?parseInt(e.target.value):null}),className:"input w-full",children:[(0,r.jsx)("option",{value:"",children:"Sin empresa"}),t.filter(e=>e.activa).map(e=>(0,r.jsx)("option",{value:e.id,children:e.nombre},e.id))]})]}),g&&(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)("input",{type:"checkbox",id:"activo",checked:y.activo,onChange:e=>b({...y,activo:e.target.checked}),className:"h-4 w-4 text-blue-600 rounded"}),(0,r.jsx)("label",{htmlFor:"activo",className:"ml-2 text-sm text-gray-700 dark:text-gray-300",children:"Usuario activo"})]}),(0,r.jsxs)("div",{className:"flex justify-end space-x-3 pt-4",children:[(0,r.jsx)("button",{type:"button",onClick:B,className:"btn-secondary",disabled:j,children:"Cancelar"}),(0,r.jsx)("button",{type:"submit",className:"btn-primary",disabled:j,children:j?"Guardando...":g?"Guardar":"Crear"})]})]})]})}),w&&(0,r.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,r.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-6 w-full max-w-md",children:[(0,r.jsx)("h2",{className:"text-xl font-bold text-gray-900 dark:text-white mb-4",children:"Contrasena Temporal"}),(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:["Se ha generado una contrasena temporal para ",(0,r.jsx)("strong",{children:L}),". El usuario debera cambiarla en su primer inicio de sesion."]}),(0,r.jsx)("div",{className:"bg-gray-100 dark:bg-gray-700 rounded-lg p-4",children:(0,r.jsx)("p",{className:"text-center font-mono text-lg text-gray-900 dark:text-white select-all",children:E})}),(0,r.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400 text-center",children:"Haz clic para seleccionar y copiar"}),(0,r.jsx)("div",{className:"flex justify-end pt-4",children:(0,r.jsx)("button",{onClick:()=>{C(!1),S(null),A(null)},className:"btn-primary",children:"Entendido"})})]})]})}),I&&M&&(0,r.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,r.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-6 w-full max-w-md",children:[(0,r.jsx)("div",{className:"flex items-center justify-center w-12 h-12 mx-auto bg-red-100 dark:bg-red-900 rounded-full mb-4",children:(0,r.jsx)("svg",{className:"h-6 w-6 text-red-600 dark:text-red-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})}),(0,r.jsx)("h2",{className:"text-xl font-bold text-gray-900 dark:text-white text-center mb-2",children:"Eliminar Usuario"}),(0,r.jsxs)("p",{className:"text-sm text-gray-600 dark:text-gray-400 text-center mb-4",children:["\xbfEstas seguro de que deseas eliminar a ",(0,r.jsx)("strong",{children:M.nombre}),"? Esta accion no se puede deshacer."]}),(0,r.jsxs)("div",{className:"flex justify-end space-x-3 pt-4",children:[(0,r.jsx)("button",{onClick:()=>z(!1),className:"btn-secondary",children:"Cancelar"}),(0,r.jsx)("button",{onClick:G,className:"bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg text-sm font-medium",children:"Eliminar"})]})]})})]})}},11888:function(e,a,t){"use strict";t.d(a,{Zn:function(){return r.Z}}),t(42530),t(57018);var r=t(81076)}},function(e){e.O(0,[7648,7859,3464,6137,1076,2971,2117,1744],function(){return e(e.s=59095)}),_N_E=e.O()}]);