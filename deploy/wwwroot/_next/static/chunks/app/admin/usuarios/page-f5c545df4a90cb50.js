(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7798],{59095:function(e,r,a){Promise.resolve().then(a.bind(a,95009))},95009:function(e,r,a){"use strict";a.r(r),a.d(r,{default:function(){return d}});var t=a(57437),s=a(2265),i=a(11888),l=a(71837);function d(){let[e,r]=(0,s.useState)([]),[a,d]=(0,s.useState)([]),[n,o]=(0,s.useState)(!0),[c,x]=(0,s.useState)(null),[m,u]=(0,s.useState)("empleados"),[p,h]=(0,s.useState)(!1),[g,y]=(0,s.useState)(null),[v,b]=(0,s.useState)({email:"",nombre:"",rol:"Empleado",empresaId:null,activo:!0}),[j,k]=(0,s.useState)(!1),[N,f]=(0,s.useState)(null),[w,C]=(0,s.useState)(!1),[E,S]=(0,s.useState)(null),[L,A]=(0,s.useState)(null),[I,z]=(0,s.useState)(!1),[M,P]=(0,s.useState)(null),U=(0,s.useCallback)(async()=>{try{o(!0);let e="empleados"===m?"Empleado":"Cliente",a=await l.ZP.get("/usuarios?rol=".concat(e));r(a.data),x(null)}catch(r){var e,a;x((null===(a=r.response)||void 0===a?void 0:null===(e=a.data)||void 0===e?void 0:e.message)||"Error al cargar usuarios")}finally{o(!1)}},[m]),Z=async()=>{try{let e=await l.ZP.get("/empresas");d(e.data)}catch(e){console.error("Error al cargar empresas:",e)}};(0,s.useEffect)(()=>{U(),Z()},[U]);let H=e=>{e?(y(e),b({email:e.email,nombre:e.nombre,rol:e.rol,empresaId:e.empresaId,activo:e.activo})):(y(null),b({email:"",nombre:"",rol:"empleados"===m?"Empleado":"Cliente",empresaId:null,activo:!0})),f(null),h(!0)},B=()=>{h(!1),y(null),f(null)},W=async e=>{e.preventDefault(),k(!0),f(null);try{if(g){let e={email:v.email,nombre:v.nombre,rol:v.rol,empresaId:v.empresaId,activo:v.activo};await l.ZP.put("/usuarios/".concat(g.id),e),B(),U()}else{let e={email:v.email,nombre:v.nombre,rol:v.rol,empresaId:v.empresaId},r=await l.ZP.post("/usuarios",e);B(),S(r.data.temporaryPassword),A(v.nombre),C(!0),U()}}catch(e){var r,a;f((null===(a=e.response)||void 0===a?void 0:null===(r=a.data)||void 0===r?void 0:r.message)||"Error al guardar usuario")}finally{k(!1)}},_=async e=>{try{await l.ZP.put("/usuarios/".concat(e.id,"/toggle-active")),U()}catch(e){var r,a;x((null===(a=e.response)||void 0===a?void 0:null===(r=a.data)||void 0===r?void 0:r.message)||"Error al cambiar estado")}},q=async e=>{try{let r=await l.ZP.post("/usuarios/".concat(e.id,"/reset-password"));S(r.data.temporaryPassword),A(e.nombre),C(!0)}catch(e){var r,a;x((null===(a=e.response)||void 0===a?void 0:null===(r=a.data)||void 0===r?void 0:r.message)||"Error al resetear contrasena")}},D=e=>{P(e),z(!0)},G=async()=>{if(M)try{await l.ZP.delete("/usuarios/".concat(M.id)),z(!1),P(null),U()}catch(a){var e,r;x((null===(r=a.response)||void 0===r?void 0:null===(e=r.data)||void 0===e?void 0:e.message)||"Error al eliminar usuario")}},R=e=>e?new Date(e).toLocaleDateString("es-ES",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}):"Nunca";return(0,t.jsxs)(i.Zn,{requiredRoles:["Admin"],children:[(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Gestion de Usuarios"}),(0,t.jsx)("p",{className:"text-gray-600 dark:text-gray-400",children:"Administra empleados y clientes del sistema"})]}),(0,t.jsx)("button",{className:"btn-primary",onClick:()=>H(),children:"Nuevo Usuario"})]}),c&&(0,t.jsx)("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-4",children:(0,t.jsx)("p",{className:"text-red-600 dark:text-red-400",children:c})}),(0,t.jsx)("div",{className:"border-b border-gray-200 dark:border-gray-700",children:(0,t.jsxs)("nav",{className:"-mb-px flex space-x-8",children:[(0,t.jsx)("button",{onClick:()=>u("empleados"),className:"whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm ".concat("empleados"===m?"border-primary-500 text-primary-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:"Empleados"}),(0,t.jsx)("button",{onClick:()=>u("clientes"),className:"whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm ".concat("clientes"===m?"border-primary-500 text-primary-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:"Clientes"})]})}),(0,t.jsx)("div",{className:"card overflow-hidden",children:n?(0,t.jsxs)("div",{className:"p-8 text-center",children:[(0,t.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600 mx-auto"}),(0,t.jsx)("p",{className:"mt-2 text-gray-500 dark:text-gray-400",children:"Cargando usuarios..."})]}):(0,t.jsxs)("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[(0,t.jsx)("thead",{className:"bg-gray-50 dark:bg-gray-800",children:(0,t.jsxs)("tr",{children:[(0,t.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Usuario"}),"clientes"===m&&(0,t.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Empresa"}),(0,t.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Estado"}),(0,t.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Ultimo Acceso"}),(0,t.jsx)("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Acciones"})]})}),(0,t.jsx)("tbody",{className:"bg-white dark:bg-gray-900 divide-y divide-gray-200 dark:divide-gray-700",children:0===e.length?(0,t.jsx)("tr",{children:(0,t.jsxs)("td",{colSpan:"clientes"===m?5:4,className:"px-6 py-12 text-center",children:[(0,t.jsx)("svg",{className:"mx-auto h-12 w-12 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"})}),(0,t.jsxs)("p",{className:"mt-4 text-gray-500 dark:text-gray-400",children:["No hay ","empleados"===m?"empleados":"clientes"," registrados"]})]})}):e.map(e=>(0,t.jsxs)("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-800",children:[(0,t.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,t.jsxs)("div",{className:"flex items-center",children:[(0,t.jsx)("div",{className:"h-10 w-10 flex-shrink-0",children:(0,t.jsx)("div",{className:"h-10 w-10 rounded-full bg-primary-100 dark:bg-primary-900 flex items-center justify-center",children:(0,t.jsx)("span",{className:"text-primary-600 dark:text-primary-400 font-medium text-sm",children:e.nombre.charAt(0).toUpperCase()})})}),(0,t.jsxs)("div",{className:"ml-4",children:[(0,t.jsx)("div",{className:"text-sm font-medium text-gray-900 dark:text-white",children:e.nombre}),(0,t.jsx)("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:e.email})]})]})}),"clientes"===m&&(0,t.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400",children:e.empresaNombre||"-"}),(0,t.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,t.jsx)("span",{className:"inline-flex px-2 py-1 text-xs font-semibold rounded-full ".concat(e.activo?"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200":"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200"),children:e.activo?"Activo":"Inactivo"})}),(0,t.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400",children:R(e.ultimoAcceso)}),(0,t.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium space-x-2",children:[(0,t.jsx)("button",{onClick:()=>H(e),className:"text-primary-600 hover:text-primary-900 dark:text-primary-400 dark:hover:text-primary-300",title:"Editar",children:(0,t.jsx)("svg",{className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})})}),(0,t.jsx)("button",{onClick:()=>q(e),className:"text-yellow-600 hover:text-yellow-900 dark:text-yellow-400 dark:hover:text-yellow-300",title:"Resetear contrasena",children:(0,t.jsx)("svg",{className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 7a2 2 0 012 2m4 0a6 6 0 01-7.743 5.743L11 17H9v2H7v2H4a1 1 0 01-1-1v-2.586a1 1 0 01.293-.707l5.964-5.964A6 6 0 1121 9z"})})}),(0,t.jsx)("button",{onClick:()=>_(e),className:"".concat(e.activo?"text-orange-600 hover:text-orange-900 dark:text-orange-400 dark:hover:text-orange-300":"text-green-600 hover:text-green-900 dark:text-green-400 dark:hover:text-green-300"),title:e.activo?"Desactivar":"Activar",children:(0,t.jsx)("svg",{className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:e.activo?"M18.364 18.364A9 9 0 005.636 5.636m12.728 12.728A9 9 0 015.636 5.636m12.728 12.728L5.636 5.636":"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})})}),(0,t.jsx)("button",{onClick:()=>D(e),className:"text-red-600 hover:text-red-900 dark:text-red-400 dark:hover:text-red-300",title:"Eliminar",children:(0,t.jsx)("svg",{className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})]},e.id))})]})})]}),p&&(0,t.jsx)("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:(0,t.jsxs)("div",{className:"flex items-center justify-center min-h-screen px-4 pt-4 pb-20 text-center sm:p-0",children:[(0,t.jsx)("div",{className:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity",onClick:B}),(0,t.jsx)("div",{className:"relative bg-white dark:bg-gray-800 rounded-lg shadow-xl transform transition-all sm:max-w-lg sm:w-full",children:(0,t.jsxs)("form",{onSubmit:W,children:[(0,t.jsx)("div",{className:"px-6 py-4 border-b border-gray-200 dark:border-gray-700",children:(0,t.jsx)("h3",{className:"text-lg font-medium text-gray-900 dark:text-white",children:g?"Editar Usuario":"Nuevo Usuario"})}),(0,t.jsxs)("div",{className:"px-6 py-4 space-y-4",children:[N&&(0,t.jsx)("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-3",children:(0,t.jsx)("p",{className:"text-sm text-red-600 dark:text-red-400",children:N})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Nombre *"}),(0,t.jsx)("input",{type:"text",required:!0,value:v.nombre,onChange:e=>b({...v,nombre:e.target.value}),className:"input-field",placeholder:"Nombre completo"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Email *"}),(0,t.jsx)("input",{type:"email",required:!0,value:v.email,onChange:e=>b({...v,email:e.target.value}),className:"input-field",placeholder:"correo@ejemplo.com"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Rol *"}),(0,t.jsxs)("select",{required:!0,value:v.rol,onChange:e=>b({...v,rol:e.target.value}),className:"input-field",children:[(0,t.jsx)("option",{value:"Empleado",children:"Empleado"}),(0,t.jsx)("option",{value:"Cliente",children:"Cliente"}),(0,t.jsx)("option",{value:"Admin",children:"Administrador"})]})]}),"Cliente"===v.rol&&(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Empresa"}),(0,t.jsxs)("select",{value:v.empresaId||"",onChange:e=>b({...v,empresaId:e.target.value?parseInt(e.target.value):null}),className:"input-field",children:[(0,t.jsx)("option",{value:"",children:"Sin empresa"}),a.filter(e=>e.activa).map(e=>(0,t.jsx)("option",{value:e.id,children:e.nombre},e.id))]})]}),g&&(0,t.jsxs)("div",{className:"flex items-center",children:[(0,t.jsx)("input",{type:"checkbox",id:"activo",checked:v.activo,onChange:e=>b({...v,activo:e.target.checked}),className:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300 rounded"}),(0,t.jsx)("label",{htmlFor:"activo",className:"ml-2 block text-sm text-gray-700 dark:text-gray-300",children:"Usuario activo"})]})]}),(0,t.jsxs)("div",{className:"px-6 py-4 border-t border-gray-200 dark:border-gray-700 flex justify-end space-x-3",children:[(0,t.jsx)("button",{type:"button",onClick:B,className:"btn-secondary",disabled:j,children:"Cancelar"}),(0,t.jsx)("button",{type:"submit",className:"btn-primary",disabled:j,children:j?"Guardando...":g?"Guardar Cambios":"Crear Usuario"})]})]})})]})}),w&&(0,t.jsx)("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:(0,t.jsxs)("div",{className:"flex items-center justify-center min-h-screen px-4 pt-4 pb-20 text-center sm:p-0",children:[(0,t.jsx)("div",{className:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity"}),(0,t.jsxs)("div",{className:"relative bg-white dark:bg-gray-800 rounded-lg shadow-xl transform transition-all sm:max-w-md sm:w-full",children:[(0,t.jsx)("div",{className:"px-6 py-4 border-b border-gray-200 dark:border-gray-700",children:(0,t.jsx)("h3",{className:"text-lg font-medium text-gray-900 dark:text-white",children:"Contrasena Temporal"})}),(0,t.jsxs)("div",{className:"px-6 py-4",children:[(0,t.jsxs)("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-4",children:["Se ha generado una contrasena temporal para ",(0,t.jsx)("strong",{children:L}),". El usuario debera cambiarla en su primer inicio de sesion."]}),(0,t.jsx)("div",{className:"bg-gray-100 dark:bg-gray-700 rounded-lg p-4",children:(0,t.jsx)("p",{className:"text-center font-mono text-lg text-gray-900 dark:text-white select-all",children:E})}),(0,t.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-2 text-center",children:"Haz clic para seleccionar y copiar"})]}),(0,t.jsx)("div",{className:"px-6 py-4 border-t border-gray-200 dark:border-gray-700 flex justify-end",children:(0,t.jsx)("button",{onClick:()=>{C(!1),S(null),A(null)},className:"btn-primary",children:"Entendido"})})]})]})}),I&&M&&(0,t.jsx)("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:(0,t.jsxs)("div",{className:"flex items-center justify-center min-h-screen px-4 pt-4 pb-20 text-center sm:p-0",children:[(0,t.jsx)("div",{className:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity",onClick:()=>z(!1)}),(0,t.jsxs)("div",{className:"relative bg-white dark:bg-gray-800 rounded-lg shadow-xl transform transition-all sm:max-w-md sm:w-full",children:[(0,t.jsxs)("div",{className:"px-6 py-4",children:[(0,t.jsx)("div",{className:"flex items-center justify-center w-12 h-12 mx-auto bg-red-100 dark:bg-red-900 rounded-full mb-4",children:(0,t.jsx)("svg",{className:"h-6 w-6 text-red-600 dark:text-red-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})}),(0,t.jsx)("h3",{className:"text-lg font-medium text-gray-900 dark:text-white text-center mb-2",children:"Eliminar Usuario"}),(0,t.jsxs)("p",{className:"text-sm text-gray-600 dark:text-gray-400 text-center",children:["\xbfEstas seguro de que deseas eliminar a ",(0,t.jsx)("strong",{children:M.nombre}),"? Esta accion no se puede deshacer."]})]}),(0,t.jsxs)("div",{className:"px-6 py-4 border-t border-gray-200 dark:border-gray-700 flex justify-end space-x-3",children:[(0,t.jsx)("button",{onClick:()=>z(!1),className:"btn-secondary",children:"Cancelar"}),(0,t.jsx)("button",{onClick:G,className:"bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg text-sm font-medium",children:"Eliminar"})]})]})]})})]})}},11888:function(e,r,a){"use strict";a.d(r,{Zn:function(){return t.Z}}),a(42530),a(57018);var t=a(81076)}},function(e){e.O(0,[7648,7859,3464,6137,1076,2971,2117,1744],function(){return e(e.s=59095)}),_N_E=e.O()}]);