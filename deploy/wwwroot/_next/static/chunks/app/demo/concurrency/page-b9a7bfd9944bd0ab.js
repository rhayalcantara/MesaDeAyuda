(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8784],{20343:function(e,r,a){Promise.resolve().then(a.bind(a,82776))},82776:function(e,r,a){"use strict";a.r(r),a.d(r,{default:function(){return d}});var t=a(57437),s=a(2265);function d(){let[e]=(0,s.useState)({id:1,titulo:"Problema de sincronizacion",descripcion:"El sistema no sincroniza los datos correctamente entre modulos.",prioridad:"Media",estado:"Abierto",rowVersion:"AAAAAAAAAA1="}),[r,a]=(0,s.useState)(e),[d,l]=(0,s.useState)(!1),[i,o]=(0,s.useState)(null),[n,c]=(0,s.useState)(e),[x,u]=(0,s.useState)(!1),[g,m]=(0,s.useState)(null),[b,h]=(0,s.useState)(e),[p,y]=(0,s.useState)(1),j=async()=>{if(l(!0),o(null),await new Promise(e=>setTimeout(e,1e3)),r.rowVersion!==b.rowVersion){o({type:"conflict",text:"Este ticket ha sido modificado por otro usuario. Por favor, recargue la pagina e intente de nuevo."}),l(!1);return}let e=p+1,t={...r,rowVersion:"AAAAAAAAAA".concat(e,"=")};h(t),y(e),a(t),o({type:"success",text:"Ticket actualizado exitosamente"}),l(!1)},k=async()=>{if(u(!0),m(null),await new Promise(e=>setTimeout(e,1e3)),n.rowVersion!==b.rowVersion){m({type:"conflict",text:"Este ticket ha sido modificado por otro usuario. Por favor, recargue la pagina e intente de nuevo."}),u(!1);return}let e=p+1,r={...n,rowVersion:"AAAAAAAAAA".concat(e,"=")};h(r),y(e),c(r),m({type:"success",text:"Ticket actualizado exitosamente"}),u(!1)};return(0,t.jsx)("div",{className:"min-h-screen bg-gray-100 dark:bg-gray-900 p-8",children:(0,t.jsxs)("div",{className:"max-w-7xl mx-auto",children:[(0,t.jsxs)("div",{className:"mb-8 text-center",children:[(0,t.jsx)("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white mb-2",children:"Demo: Concurrencia - Feature #143"}),(0,t.jsx)("p",{className:"text-gray-600 dark:text-gray-400",children:"Prueba de manejo de edicion concurrente del mismo registro"}),(0,t.jsx)("button",{onClick:()=>{a(e),c(e),h(e),y(1),o(null),m(null)},className:"mt-4 px-4 py-2 bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-md hover:bg-gray-300 dark:hover:bg-gray-600",children:"Reiniciar Demo"})]}),(0,t.jsxs)("div",{className:"mb-8 p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg border border-blue-200 dark:border-blue-800",children:[(0,t.jsx)("h2",{className:"text-lg font-semibold text-blue-800 dark:text-blue-200 mb-2",children:"Estado del Servidor (Base de Datos)"}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"text-blue-600 dark:text-blue-400 font-medium",children:"Titulo:"})," ",(0,t.jsx)("span",{className:"text-gray-700 dark:text-gray-300",children:b.titulo})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"text-blue-600 dark:text-blue-400 font-medium",children:"Prioridad:"})," ",(0,t.jsx)("span",{className:"text-gray-700 dark:text-gray-300",children:b.prioridad})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"text-blue-600 dark:text-blue-400 font-medium",children:"RowVersion:"})," ",(0,t.jsx)("code",{className:"text-gray-700 dark:text-gray-300 bg-blue-100 dark:bg-blue-800/50 px-2 py-1 rounded",children:b.rowVersion})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"text-blue-600 dark:text-blue-400 font-medium",children:"Version #:"})," ",(0,t.jsx)("span",{className:"text-gray-700 dark:text-gray-300",children:p})]})]})]}),(0,t.jsxs)("div",{className:"mb-8 p-4 bg-yellow-50 dark:bg-yellow-900/20 rounded-lg border border-yellow-200 dark:border-yellow-800",children:[(0,t.jsx)("h3",{className:"text-lg font-semibold text-yellow-800 dark:text-yellow-200 mb-2",children:"Instrucciones de prueba"}),(0,t.jsxs)("ol",{className:"list-decimal list-inside text-sm text-yellow-700 dark:text-yellow-300 space-y-1",children:[(0,t.jsx)("li",{children:"Ambos usuarios (A y B) tienen el mismo ticket abierto para editar"}),(0,t.jsx)("li",{children:"El Usuario A modifica el titulo y guarda primero"}),(0,t.jsx)("li",{children:"El Usuario B modifica la prioridad e intenta guardar"}),(0,t.jsxs)("li",{children:["El Usuario B recibe un ",(0,t.jsx)("strong",{children:"error de conflicto"})," porque el ticket fue modificado"]}),(0,t.jsx)("li",{children:"El Usuario B debe recargar para obtener la version actual antes de poder guardar"})]})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[(0,t.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-lg overflow-hidden",children:[(0,t.jsxs)("div",{className:"bg-green-500 text-white px-6 py-4",children:[(0,t.jsx)("h2",{className:"text-xl font-bold",children:"Usuario A"}),(0,t.jsx)("p",{className:"text-green-100 text-sm",children:"Sesion del primer usuario"})]}),(0,t.jsxs)("div",{className:"p-6 space-y-4",children:[i&&(0,t.jsxs)("div",{role:"alert",className:"p-4 rounded-md ".concat("success"===i.type?"bg-green-50 dark:bg-green-900/20 text-green-800 dark:text-green-200 border border-green-200 dark:border-green-800":"conflict"===i.type?"bg-orange-50 dark:bg-orange-900/20 text-orange-800 dark:text-orange-200 border border-orange-200 dark:border-orange-800":"bg-red-50 dark:bg-red-900/20 text-red-800 dark:text-red-200 border border-red-200 dark:border-red-800"),children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:["success"===i.type&&(0,t.jsx)("span",{children:"✅"}),"conflict"===i.type&&(0,t.jsx)("span",{children:"⚠️"}),"error"===i.type&&(0,t.jsx)("span",{children:"❌"}),(0,t.jsx)("span",{children:i.text})]}),"conflict"===i.type&&(0,t.jsx)("button",{onClick:()=>{a(b),o(null)},className:"mt-2 text-sm underline hover:no-underline",children:"Recargar datos actuales"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Titulo"}),(0,t.jsx)("input",{type:"text",value:r.titulo,onChange:e=>a({...r,titulo:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Prioridad"}),(0,t.jsxs)("select",{value:r.prioridad,onChange:e=>a({...r,prioridad:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white",children:[(0,t.jsx)("option",{value:"Baja",children:"Baja"}),(0,t.jsx)("option",{value:"Media",children:"Media"}),(0,t.jsx)("option",{value:"Alta",children:"Alta"})]})]}),(0,t.jsxs)("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:["RowVersion local: ",(0,t.jsx)("code",{className:"bg-gray-100 dark:bg-gray-700 px-1 rounded",children:r.rowVersion})]}),(0,t.jsx)("button",{onClick:j,disabled:d,className:"w-full px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:d?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("svg",{className:"animate-spin h-4 w-4",viewBox:"0 0 24 24",children:[(0,t.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4",fill:"none"}),(0,t.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Guardando..."]}):"Guardar cambios"})]})]}),(0,t.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-lg overflow-hidden",children:[(0,t.jsxs)("div",{className:"bg-purple-500 text-white px-6 py-4",children:[(0,t.jsx)("h2",{className:"text-xl font-bold",children:"Usuario B"}),(0,t.jsx)("p",{className:"text-purple-100 text-sm",children:"Sesion del segundo usuario"})]}),(0,t.jsxs)("div",{className:"p-6 space-y-4",children:[g&&(0,t.jsxs)("div",{role:"alert",className:"p-4 rounded-md ".concat("success"===g.type?"bg-green-50 dark:bg-green-900/20 text-green-800 dark:text-green-200 border border-green-200 dark:border-green-800":"conflict"===g.type?"bg-orange-50 dark:bg-orange-900/20 text-orange-800 dark:text-orange-200 border border-orange-200 dark:border-orange-800":"bg-red-50 dark:bg-red-900/20 text-red-800 dark:text-red-200 border border-red-200 dark:border-red-800"),children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:["success"===g.type&&(0,t.jsx)("span",{children:"✅"}),"conflict"===g.type&&(0,t.jsx)("span",{children:"⚠️"}),"error"===g.type&&(0,t.jsx)("span",{children:"❌"}),(0,t.jsx)("span",{children:g.text})]}),"conflict"===g.type&&(0,t.jsx)("button",{onClick:()=>{c(b),m(null)},className:"mt-2 text-sm underline hover:no-underline",children:"Recargar datos actuales"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Titulo"}),(0,t.jsx)("input",{type:"text",value:n.titulo,onChange:e=>c({...n,titulo:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Prioridad"}),(0,t.jsxs)("select",{value:n.prioridad,onChange:e=>c({...n,prioridad:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white",children:[(0,t.jsx)("option",{value:"Baja",children:"Baja"}),(0,t.jsx)("option",{value:"Media",children:"Media"}),(0,t.jsx)("option",{value:"Alta",children:"Alta"})]})]}),(0,t.jsxs)("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:["RowVersion local: ",(0,t.jsx)("code",{className:"bg-gray-100 dark:bg-gray-700 px-1 rounded",children:n.rowVersion})]}),(0,t.jsx)("button",{onClick:k,disabled:x,className:"w-full px-4 py-2 bg-purple-600 text-white rounded-md hover:bg-purple-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:x?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("svg",{className:"animate-spin h-4 w-4",viewBox:"0 0 24 24",children:[(0,t.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4",fill:"none"}),(0,t.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Guardando..."]}):"Guardar cambios"})]})]})]}),(0,t.jsxs)("div",{className:"mt-8 p-4 bg-gray-50 dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700",children:[(0,t.jsx)("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-2",children:"Implementacion Tecnica"}),(0,t.jsxs)("ul",{className:"text-sm text-gray-600 dark:text-gray-400 space-y-2",children:[(0,t.jsxs)("li",{children:[(0,t.jsx)("strong",{children:"Optimistic Locking:"})," Usamos un campo RowVersion (timestamp) para detectar conflictos"]}),(0,t.jsxs)("li",{children:[(0,t.jsx)("strong",{children:"Backend:"})," El modelo Ticket tiene [Timestamp] RowVersion que EF Core maneja automaticamente"]}),(0,t.jsxs)("li",{children:[(0,t.jsx)("strong",{children:"API:"})," PUT /api/tickets/:id incluye el RowVersion y retorna HTTP 409 Conflict si hay conflicto"]}),(0,t.jsxs)("li",{children:[(0,t.jsx)("strong",{children:"Frontend:"})," Muestra mensaje claro y opcion de recargar cuando hay conflicto"]}),(0,t.jsxs)("li",{children:[(0,t.jsx)("strong",{children:"UX:"})," El usuario no pierde sus cambios - puede recargar y volver a aplicarlos"]})]})]}),(0,t.jsx)("div",{className:"mt-4 text-center",children:(0,t.jsx)("a",{href:"/demo",className:"text-blue-600 dark:text-blue-400 hover:underline",children:"← Volver a la demo principal"})})]})})}}},function(e){e.O(0,[2971,2117,1744],function(){return e(e.s=20343)}),_N_E=e.O()}]);